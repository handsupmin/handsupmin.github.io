<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>이더리움 PoS(Proof of Stake) 소개 | HandsLog</title>
<meta name=keywords content="ethereum,PoS,beacon-chain,staking,slot,epoch,validator"><meta name=description content="개요
이 문서는 이더리움의 PoS 합의 구조와 구성 요소를 정리함
개념 정의에 그치지 않고 운영 시 주의점, 보상·출금 흐름, 짧은 체인 재구성(Reorg) 원인과 완화책까지 다룸

개념과 배경
PoS는 PoW의 에너지 경쟁을 대체해 예치된 지분을 바탕으로 검증자를 선정하는 합의 메커니즘임
이더리움은 2022년 9월 더 머지 이후 PoS로 전환했고 전력 소비를 크게 줄이며 검증자 기반 보안 모델로 이행함
주요 속성 요약

에너지 소비 대폭 축소
스테이킹한 ETH 규모에 비례해 역할 참여 기회가 부여됨
위반 시 슬래싱과 페널티로 예치금이 감소함


계층 분리와 Beacon Chain의 역할
이더리움은 합의 계층(Beacon Chain) 과 실행 계층(Execution Layer) 를 분리해 설계함"><meta name=author content><link rel=canonical href=https://handsupmin.github.io/posts/ethereum-pos-proof-of-stake-274b74/><link crossorigin=anonymous href=/assets/css/stylesheet.08f7d74f0ada0f975d29ae436285b61ed7a719d05f350cb888d00341642995a2.css integrity="sha256-CPfXTwraD5ddKa5DYoW2HtenGdBfNQy4iNADQWQplaI=" rel="preload stylesheet" as=style><link rel=icon href=https://handsupmin.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://handsupmin.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://handsupmin.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://handsupmin.github.io/apple-touch-icon.png><link rel=mask-icon href=https://handsupmin.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/json href=https://handsupmin.github.io/posts/ethereum-pos-proof-of-stake-274b74/index.json><link rel=alternate hreflang=en href=https://handsupmin.github.io/posts/ethereum-pos-proof-of-stake-274b74/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NKJRT1NC1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6NKJRT1NC1")</script><meta name=google-adsense-account content="ca-pub-6022353980017733"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6022353980017733" crossorigin=anonymous></script><meta property="og:url" content="https://handsupmin.github.io/posts/ethereum-pos-proof-of-stake-274b74/"><meta property="og:site_name" content="HandsLog"><meta property="og:title" content="이더리움 PoS(Proof of Stake) 소개"><meta property="og:description" content="개요 이 문서는 이더리움의 PoS 합의 구조와 구성 요소를 정리함 개념 정의에 그치지 않고 운영 시 주의점, 보상·출금 흐름, 짧은 체인 재구성(Reorg) 원인과 완화책까지 다룸
개념과 배경 PoS는 PoW의 에너지 경쟁을 대체해 예치된 지분을 바탕으로 검증자를 선정하는 합의 메커니즘임 이더리움은 2022년 9월 더 머지 이후 PoS로 전환했고 전력 소비를 크게 줄이며 검증자 기반 보안 모델로 이행함
주요 속성 요약
에너지 소비 대폭 축소 스테이킹한 ETH 규모에 비례해 역할 참여 기회가 부여됨 위반 시 슬래싱과 페널티로 예치금이 감소함 계층 분리와 Beacon Chain의 역할 이더리움은 합의 계층(Beacon Chain) 과 실행 계층(Execution Layer) 를 분리해 설계함"><meta property="og:locale" content="ko-kr"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-20T17:04:48+00:00"><meta property="article:modified_time" content="2025-09-20T17:04:48+00:00"><meta property="article:tag" content="Ethereum"><meta property="article:tag" content="PoS"><meta property="article:tag" content="Beacon-Chain"><meta property="article:tag" content="Staking"><meta property="article:tag" content="Slot"><meta property="article:tag" content="Epoch"><meta name=twitter:card content="summary"><meta name=twitter:title content="이더리움 PoS(Proof of Stake) 소개"><meta name=twitter:description content="개요
이 문서는 이더리움의 PoS 합의 구조와 구성 요소를 정리함
개념 정의에 그치지 않고 운영 시 주의점, 보상·출금 흐름, 짧은 체인 재구성(Reorg) 원인과 완화책까지 다룸

개념과 배경
PoS는 PoW의 에너지 경쟁을 대체해 예치된 지분을 바탕으로 검증자를 선정하는 합의 메커니즘임
이더리움은 2022년 9월 더 머지 이후 PoS로 전환했고 전력 소비를 크게 줄이며 검증자 기반 보안 모델로 이행함
주요 속성 요약

에너지 소비 대폭 축소
스테이킹한 ETH 규모에 비례해 역할 참여 기회가 부여됨
위반 시 슬래싱과 페널티로 예치금이 감소함


계층 분리와 Beacon Chain의 역할
이더리움은 합의 계층(Beacon Chain) 과 실행 계층(Execution Layer) 를 분리해 설계함"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://handsupmin.github.io/posts/"},{"@type":"ListItem","position":2,"name":"이더리움 PoS(Proof of Stake) 소개","item":"https://handsupmin.github.io/posts/ethereum-pos-proof-of-stake-274b74/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"이더리움 PoS(Proof of Stake) 소개","name":"이더리움 PoS(Proof of Stake) 소개","description":"개요 이 문서는 이더리움의 PoS 합의 구조와 구성 요소를 정리함 개념 정의에 그치지 않고 운영 시 주의점, 보상·출금 흐름, 짧은 체인 재구성(Reorg) 원인과 완화책까지 다룸\n개념과 배경 PoS는 PoW의 에너지 경쟁을 대체해 예치된 지분을 바탕으로 검증자를 선정하는 합의 메커니즘임 이더리움은 2022년 9월 더 머지 이후 PoS로 전환했고 전력 소비를 크게 줄이며 검증자 기반 보안 모델로 이행함\n주요 속성 요약\n에너지 소비 대폭 축소 스테이킹한 ETH 규모에 비례해 역할 참여 기회가 부여됨 위반 시 슬래싱과 페널티로 예치금이 감소함 계층 분리와 Beacon Chain의 역할 이더리움은 합의 계층(Beacon Chain) 과 실행 계층(Execution Layer) 를 분리해 설계함\n","keywords":["ethereum","PoS","beacon-chain","staking","slot","epoch","validator"],"articleBody":"개요 이 문서는 이더리움의 PoS 합의 구조와 구성 요소를 정리함 개념 정의에 그치지 않고 운영 시 주의점, 보상·출금 흐름, 짧은 체인 재구성(Reorg) 원인과 완화책까지 다룸\n개념과 배경 PoS는 PoW의 에너지 경쟁을 대체해 예치된 지분을 바탕으로 검증자를 선정하는 합의 메커니즘임 이더리움은 2022년 9월 더 머지 이후 PoS로 전환했고 전력 소비를 크게 줄이며 검증자 기반 보안 모델로 이행함\n주요 속성 요약\n에너지 소비 대폭 축소 스테이킹한 ETH 규모에 비례해 역할 참여 기회가 부여됨 위반 시 슬래싱과 페널티로 예치금이 감소함 계층 분리와 Beacon Chain의 역할 이더리움은 합의 계층(Beacon Chain) 과 실행 계층(Execution Layer) 를 분리해 설계함\n실행 계층은 트랜잭션 처리와 EVM 실행을 담당함 Beacon Chain은 시간 관리와 역할 배정, 투표 집계, 최종성 판단을 담당함 Beacon Chain의 핵심 기능\n슬롯과 에포크라는 통일된 시간 프레임 제공 매 슬롯의 블록 제안자와 증명자 배정 증명자 투표를 집계해 정당한 체인과 최종성을 결정함 이 분리는 클라이언트 다양성 확보와 확장 로드맵에 유리한 아키텍처 선택임\n시간 구조와 동작 단위 슬롯(slot)\n블록 제안이 가능한 최소 시간 단위 1 슬롯 = 12초 슬롯마다 1명의 제안자만 지정됨 제안자가 제때 블록을 제안하지 못하면 슬롯 미스로 간주하고 빈 슬롯이 될 수 있음 에포크(epoch)\n1 에포크 = 32 슬롯 ≈ 6분 24초 에포크 단위로 위원회 재편성, 랜덤 시드 갱신, 최종성 관련 집계가 이뤄짐 에포크는 체크포인트 역할을 하며 최종성 로직의 기준 단위로 사용됨 검증자와 스테이킹 규칙 최소 32 ETH를 예치해야 정식 검증자가 됨 한 검증자 계정에 반영되는 유효 예치 상한은 32 ETH임 더 많은 ETH를 운용하려면 32 ETH 단위로 여러 검증자를 운영해야 함 검증자 활성·비활성 전환에는 대기 큐와 지연이 존재함 보상 기회는 전체 검증자 대비 보유 검증자 수에 비례해 증가함 예를 들어 64 ETH로 두 검증자를 운영하면 제안·투표 참여 기회가 대략 두 배가 됨\n제안자(Proposer)와 증명자(Attester) 매 슬롯 한 명의 제안자가 블록을 제안함 다수의 증명자가 해당 블록에 대해 attestation 을 제출함 검증자들은 여러 위원회(committee) 로 무작위 배정되어 병렬로 검증을 수행함 집계된 투표는 포크 선택과 최종성 판단에 사용됨 위원회 구조의 목적은 검증 부담 분산 과 독립 다중 관측 을 통해 안전성과 처리량을 동시에 확보하는 것임\n무작위성과 검증자 배정 이더리움은 RANDAO 믹스 를 사용해 예측이 어렵고 조작에 강한 난수를 생성함 역사적으로 VRF나 VDF 같은 대안이 거론되었으나 현재 메인넷은 RANDAO 기반을 사용함 생성된 난수는 차기 에포크의 제안자·위원회 배정에 활용됨 특정 주체가 지속 우선 선정되는 편향을 줄이는 것이 목표임 포크 선택과 최종성 개요 포크 선택은 LMD‑GHOST 를 기반으로 하며 최신 메시지를 반영해 가장 무거운 서브트리를 선택함 짧은 지연으로 더 나은 블록을 선택하도록 proposer boost 가 도입되어 reorg 위험을 줄임 최종성은 Casper FFG 를 통해 에포크 수준 체크포인트를 정당화·최종화함 일정 이상 검증자 참여가 확보되면 체크포인트가 finalized 상태가 되어 경제적으로 되돌리기 매우 어려워짐 보상과 벌칙의 구조 보상 항목\n블록 제안 보상 제안자가 유효 블록을 포함할 때 수취 증명 보상 attestation을 정확하고 신속하게 제출한 검증자에게 지급 동기화 위원회 보상 라이트 클라이언트 지원을 위한 서명 참여 검증자에게 지급 벌칙과 슬래싱\n오프라인이나 지연 제출 등에는 경미한 페널티 가 부과됨 체인이 장기간 미파이널리티 상태에 빠지면 inactivity leak 이 발생해 페널티가 점진적으로 커짐 슬래싱 은 이중 제안 혹은 이중·감싸기 투표 같은 안전성 위반에 적용되며 금액과 네트워크 상황에 따라 손실이 커질 수 있음 동일 키를 여러 노드에서 가동하면 슬래싱 위험이 급증하므로 금지해야 함 보상 규모와 페널티는 전체 활성 예치 규모와 참여율 등 네트워크 상태에 따라 동적으로 변함\n출금과 인출 흐름 2023년 상반기 업그레이드 이후 출금 기능 이 활성화됨 부분 출금 은 32 ETH 초과분이 자동으로 실행 계층의 출금 주소로 전달됨 완전 출금 은 검증자가 정상 종료를 통해 활성 집합에서 빠진 뒤 전 잔액을 인출하는 흐름임 출금 처리는 블록당 포함 가능한 수가 제한되어 있어 대기 지연이 발생할 수 있음 출금 주소 유형과 자격 전환이 올바르게 설정되어 있어야 자동 처리가 가능함 운영 포인트\n출금 대기 시간과 큐 상태를 모니터링해 유동성을 관리함 출금 주소 관리 실수를 방지하기 위해 변경 절차를 문서화하고 검증 절차를 둠 Reorg가 발생하는 이유와 완화책 Reorg는 PoS에서도 짧은 길이 로 발생할 수 있음 주요 원인\n블록·attestation 전파 지연으로 노드 간 관측 차이가 발생함 슬롯 미스 이후 후속 제안자가 다른 선행 상태를 기준으로 블록을 만들 수 있음 노드 시간 동기화 불량이나 리소스 병목으로 처리 지연이 발생함 완화책\n시간 동기화는 chrony 등으로 정확히 유지함 고품질 피어 확보와 충분한 피어 수를 유지하고 네트워크 지연을 최소화함 최신 클라이언트와 다양한 클라이언트 조합으로 클라이언트 다양성 을 보장함 proposer boost와 attest 포함 지연 지표를 모니터링해 파라미터와 인프라를 튜닝함 대부분의 reorg는 1~2 블록에서 수렴하며 최종성 규칙으로 빠르게 안정화됨\n운영 체크리스트 노드와 인프라\n최신 합의·실행 클라이언트 유지 피어 수·지연·대역폭·디스크 IOPS 모니터링 장애를 분리하기 위해 실행·합의 클라이언트의 조합을 다양화함 키 관리\n슬래싱 방지 파일과 원격 서명기 사용 시 중복 서명 방지 설정 확인 단일 실패 지점 제거를 위해 핫·백업 구성과 자동 페일오버를 명확히 구분함 키 백업과 복구 절차를 오프라인으로 주기 점검함 운영 정책\n32 ETH 단위로 검증자를 수평 확장해 장애 격리와 보상 변동성을 줄임 모니터링 지표를 표준화함 참여율, attestation 포함 거리, 미스 슬롯, reorg 발생률, 동기화 위원회 가동률, 출금 큐 길이 등 MEV‑Boost 사용 시 릴레이 다양화와 로컬 빌더 폴백을 준비해 가용성과 검열 리스크를 낮춤 위험과 중앙화 고려 거대 스테이킹 풀과 커스터디 집중은 검열·단일 실패 지점 위험을 키움 클라이언트 다양성 부족은 버그 발생 시 네트워크 안정성을 해칠 수 있음 리퀴드 스테이킹 파생상품은 유동성을 제공하지만 의사결정 집중과 딜레마를 유발할 수 있음 정책과 거버넌스, 릴레이·빌더 다양화, 커뮤니티 모니터링으로 리스크를 분산해야 함 마무리 이더리움 PoS는 RANDAO 기반 무작위성, LMD‑GHOST 포크 선택, Casper FFG 최종성, 검증자 보상·벌칙 체계 를 결합해 에너지 효율과 보안을 동시에 달성하려는 설계임 운영자는 시간 동기화와 피어 품질, 키 관리, 클라이언트 다양성, 보상·출금 파이프라인을 지속적으로 점검해야 함 짧은 reorg는 네트워크 현실에서 발생할 수 있으나 적절한 인프라와 파라미터 튜닝, 최신 클라이언트 운용으로 빈도와 영향을 최소화할 수 있음\n참고자료 이더리움 PoS 개요 https://ethereum.org/en/developers/docs/consensus-mechanisms/pos 합의 사양과 가스퍼 개요 https://github.com/ethereum/consensus-specs EIP‑4895 출금과 Capella 업그레이드 참고 https://eips.ethereum.org/EIPS/eip-4895 합의 계층 클라이언트와 실행 계층 클라이언트 목록 https://ethereum.org/en/developers/docs/nodes-and-clients MEV‑Boost 운영 가이드 참고 https://www.flashbots.net ","wordCount":"904","inLanguage":"en","datePublished":"2025-09-20T17:04:48.781Z","dateModified":"2025-09-20T17:04:48.781Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://handsupmin.github.io/posts/ethereum-pos-proof-of-stake-274b74/"},"publisher":{"@type":"Organization","name":"HandsLog","logo":{"@type":"ImageObject","url":"https://handsupmin.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://handsupmin.github.io/ accesskey=h title="HandsLog (Alt + H)">HandsLog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://handsupmin.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://handsupmin.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://jsontapose.com/ title="Cool Tool"><span>Cool Tool</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://handsupmin.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://handsupmin.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">이더리움 PoS(Proof of Stake) 소개</h1><div class=post-meta><span title='2025-09-20 17:04:48.781 +0000 UTC'>September 20, 2025</span></div></header><div class=post-content><h3 id=개요>개요<a hidden class=anchor aria-hidden=true href=#개요>#</a></h3><p>이 문서는 이더리움의 PoS 합의 구조와 구성 요소를 정리함
개념 정의에 그치지 않고 <strong>운영 시 주의점</strong>, <strong>보상·출금 흐름</strong>, <strong>짧은 체인 재구성(Reorg) 원인과 완화책</strong>까지 다룸</p><hr><h3 id=개념과-배경>개념과 배경<a hidden class=anchor aria-hidden=true href=#개념과-배경>#</a></h3><p>PoS는 PoW의 에너지 경쟁을 대체해 <strong>예치된 지분을 바탕으로 검증자를 선정</strong>하는 합의 메커니즘임
이더리움은 2022년 9월 더 머지 이후 PoS로 전환했고 전력 소비를 크게 줄이며 <strong>검증자 기반 보안 모델</strong>로 이행함</p><p>주요 속성 요약</p><ul><li>에너지 소비 대폭 축소</li><li>스테이킹한 ETH 규모에 비례해 역할 참여 기회가 부여됨</li><li>위반 시 슬래싱과 페널티로 예치금이 감소함</li></ul><hr><h3 id=계층-분리와-beacon-chain의-역할>계층 분리와 Beacon Chain의 역할<a hidden class=anchor aria-hidden=true href=#계층-분리와-beacon-chain의-역할>#</a></h3><p>이더리움은 <strong>합의 계층(Beacon Chain)</strong> 과 <strong>실행 계층(Execution Layer)</strong> 를 분리해 설계함</p><ul><li>실행 계층은 트랜잭션 처리와 EVM 실행을 담당함</li><li>Beacon Chain은 시간 관리와 역할 배정, 투표 집계, 최종성 판단을 담당함</li></ul><p>Beacon Chain의 핵심 기능</p><ul><li>슬롯과 에포크라는 통일된 시간 프레임 제공</li><li>매 슬롯의 블록 제안자와 증명자 배정</li><li>증명자 투표를 집계해 정당한 체인과 최종성을 결정함</li></ul><p>이 분리는 클라이언트 다양성 확보와 확장 로드맵에 유리한 아키텍처 선택임</p><hr><h3 id=시간-구조와-동작-단위>시간 구조와 동작 단위<a hidden class=anchor aria-hidden=true href=#시간-구조와-동작-단위>#</a></h3><p><strong>슬롯(slot)</strong></p><ul><li>블록 제안이 가능한 최소 시간 단위</li><li>1 슬롯 = 12초</li><li>슬롯마다 1명의 제안자만 지정됨</li><li>제안자가 제때 블록을 제안하지 못하면 슬롯 미스로 간주하고 빈 슬롯이 될 수 있음</li></ul><p><strong>에포크(epoch)</strong></p><ul><li>1 에포크 = 32 슬롯 ≈ 6분 24초</li><li>에포크 단위로 위원회 재편성, 랜덤 시드 갱신, 최종성 관련 집계가 이뤄짐</li><li>에포크는 체크포인트 역할을 하며 최종성 로직의 기준 단위로 사용됨</li></ul><hr><h3 id=검증자와-스테이킹-규칙>검증자와 스테이킹 규칙<a hidden class=anchor aria-hidden=true href=#검증자와-스테이킹-규칙>#</a></h3><ul><li>최소 32 ETH를 예치해야 <strong>정식 검증자</strong>가 됨</li><li>한 검증자 계정에 반영되는 유효 예치 상한은 32 ETH임</li><li>더 많은 ETH를 운용하려면 32 ETH 단위로 여러 검증자를 운영해야 함</li><li>검증자 활성·비활성 전환에는 대기 큐와 지연이 존재함</li></ul><p>보상 기회는 전체 검증자 대비 보유 검증자 수에 비례해 증가함
예를 들어 64 ETH로 두 검증자를 운영하면 제안·투표 참여 기회가 대략 두 배가 됨</p><hr><h3 id=제안자proposer와-증명자attester>제안자(Proposer)와 증명자(Attester)<a hidden class=anchor aria-hidden=true href=#제안자proposer와-증명자attester>#</a></h3><ul><li>매 슬롯 한 명의 <strong>제안자</strong>가 블록을 제안함</li><li>다수의 <strong>증명자</strong>가 해당 블록에 대해 <strong>attestation</strong> 을 제출함</li><li>검증자들은 여러 <strong>위원회(committee)</strong> 로 무작위 배정되어 병렬로 검증을 수행함</li><li>집계된 투표는 포크 선택과 최종성 판단에 사용됨</li></ul><p>위원회 구조의 목적은 <strong>검증 부담 분산</strong> 과 <strong>독립 다중 관측</strong> 을 통해 안전성과 처리량을 동시에 확보하는 것임</p><hr><h3 id=무작위성과-검증자-배정>무작위성과 검증자 배정<a hidden class=anchor aria-hidden=true href=#무작위성과-검증자-배정>#</a></h3><ul><li>이더리움은 <strong>RANDAO 믹스</strong> 를 사용해 예측이 어렵고 조작에 강한 난수를 생성함</li><li>역사적으로 VRF나 VDF 같은 대안이 거론되었으나 현재 메인넷은 RANDAO 기반을 사용함</li><li>생성된 난수는 차기 에포크의 제안자·위원회 배정에 활용됨</li><li>특정 주체가 지속 우선 선정되는 편향을 줄이는 것이 목표임</li></ul><hr><h3 id=포크-선택과-최종성-개요>포크 선택과 최종성 개요<a hidden class=anchor aria-hidden=true href=#포크-선택과-최종성-개요>#</a></h3><ul><li>포크 선택은 <strong>LMD‑GHOST</strong> 를 기반으로 하며 최신 메시지를 반영해 가장 무거운 서브트리를 선택함</li><li>짧은 지연으로 더 나은 블록을 선택하도록 <strong>proposer boost</strong> 가 도입되어 reorg 위험을 줄임</li><li>최종성은 <strong>Casper FFG</strong> 를 통해 에포크 수준 체크포인트를 정당화·최종화함</li><li>일정 이상 검증자 참여가 확보되면 체크포인트가 <strong>finalized</strong> 상태가 되어 경제적으로 되돌리기 매우 어려워짐</li></ul><hr><h3 id=보상과-벌칙의-구조>보상과 벌칙의 구조<a hidden class=anchor aria-hidden=true href=#보상과-벌칙의-구조>#</a></h3><p>보상 항목</p><ul><li><strong>블록 제안 보상</strong> 제안자가 유효 블록을 포함할 때 수취</li><li><strong>증명 보상</strong> attestation을 정확하고 신속하게 제출한 검증자에게 지급</li><li><strong>동기화 위원회 보상</strong> 라이트 클라이언트 지원을 위한 서명 참여 검증자에게 지급</li></ul><p>벌칙과 슬래싱</p><ul><li>오프라인이나 지연 제출 등에는 <strong>경미한 페널티</strong> 가 부과됨</li><li>체인이 장기간 미파이널리티 상태에 빠지면 <strong>inactivity leak</strong> 이 발생해 페널티가 점진적으로 커짐</li><li><strong>슬래싱</strong> 은 이중 제안 혹은 이중·감싸기 투표 같은 안전성 위반에 적용되며 금액과 네트워크 상황에 따라 손실이 커질 수 있음</li><li>동일 키를 여러 노드에서 가동하면 슬래싱 위험이 급증하므로 금지해야 함</li></ul><p>보상 규모와 페널티는 전체 활성 예치 규모와 참여율 등 네트워크 상태에 따라 동적으로 변함</p><hr><h3 id=출금과-인출-흐름>출금과 인출 흐름<a hidden class=anchor aria-hidden=true href=#출금과-인출-흐름>#</a></h3><ul><li>2023년 상반기 업그레이드 이후 <strong>출금 기능</strong> 이 활성화됨</li><li><strong>부분 출금</strong> 은 32 ETH 초과분이 자동으로 실행 계층의 출금 주소로 전달됨</li><li><strong>완전 출금</strong> 은 검증자가 정상 종료를 통해 활성 집합에서 빠진 뒤 전 잔액을 인출하는 흐름임</li><li>출금 처리는 블록당 포함 가능한 수가 제한되어 있어 대기 지연이 발생할 수 있음</li><li>출금 주소 유형과 자격 전환이 올바르게 설정되어 있어야 자동 처리가 가능함</li></ul><p>운영 포인트</p><ul><li>출금 대기 시간과 큐 상태를 모니터링해 유동성을 관리함</li><li>출금 주소 관리 실수를 방지하기 위해 변경 절차를 문서화하고 검증 절차를 둠</li></ul><hr><h3 id=reorg가-발생하는-이유와-완화책>Reorg가 발생하는 이유와 완화책<a hidden class=anchor aria-hidden=true href=#reorg가-발생하는-이유와-완화책>#</a></h3><p>Reorg는 PoS에서도 <strong>짧은 길이</strong> 로 발생할 수 있음
주요 원인</p><ul><li>블록·attestation 전파 지연으로 노드 간 관측 차이가 발생함</li><li>슬롯 미스 이후 후속 제안자가 다른 선행 상태를 기준으로 블록을 만들 수 있음</li><li>노드 시간 동기화 불량이나 리소스 병목으로 처리 지연이 발생함</li></ul><p>완화책</p><ul><li>시간 동기화는 <strong>chrony</strong> 등으로 정확히 유지함</li><li>고품질 피어 확보와 충분한 피어 수를 유지하고 네트워크 지연을 최소화함</li><li>최신 클라이언트와 다양한 클라이언트 조합으로 <strong>클라이언트 다양성</strong> 을 보장함</li><li>proposer boost와 attest 포함 지연 지표를 모니터링해 파라미터와 인프라를 튜닝함</li></ul><p>대부분의 reorg는 1~2 블록에서 수렴하며 최종성 규칙으로 빠르게 안정화됨</p><hr><h3 id=운영-체크리스트>운영 체크리스트<a hidden class=anchor aria-hidden=true href=#운영-체크리스트>#</a></h3><p>노드와 인프라</p><ul><li>최신 합의·실행 클라이언트 유지</li><li>피어 수·지연·대역폭·디스크 IOPS 모니터링</li><li>장애를 분리하기 위해 실행·합의 클라이언트의 조합을 다양화함</li></ul><p>키 관리</p><ul><li>슬래싱 방지 파일과 원격 서명기 사용 시 중복 서명 방지 설정 확인</li><li>단일 실패 지점 제거를 위해 핫·백업 구성과 자동 페일오버를 명확히 구분함</li><li>키 백업과 복구 절차를 오프라인으로 주기 점검함</li></ul><p>운영 정책</p><ul><li>32 ETH 단위로 검증자를 수평 확장해 장애 격리와 보상 변동성을 줄임</li><li>모니터링 지표를 표준화함 참여율, attestation 포함 거리, 미스 슬롯, reorg 발생률, 동기화 위원회 가동률, 출금 큐 길이 등</li><li>MEV‑Boost 사용 시 릴레이 다양화와 로컬 빌더 폴백을 준비해 가용성과 검열 리스크를 낮춤</li></ul><hr><h3 id=위험과-중앙화-고려>위험과 중앙화 고려<a hidden class=anchor aria-hidden=true href=#위험과-중앙화-고려>#</a></h3><ul><li>거대 스테이킹 풀과 커스터디 집중은 검열·단일 실패 지점 위험을 키움</li><li>클라이언트 다양성 부족은 버그 발생 시 네트워크 안정성을 해칠 수 있음</li><li>리퀴드 스테이킹 파생상품은 유동성을 제공하지만 의사결정 집중과 딜레마를 유발할 수 있음</li><li>정책과 거버넌스, 릴레이·빌더 다양화, 커뮤니티 모니터링으로 리스크를 분산해야 함</li></ul><hr><h3 id=마무리>마무리<a hidden class=anchor aria-hidden=true href=#마무리>#</a></h3><p>이더리움 PoS는 <strong>RANDAO 기반 무작위성</strong>, <strong>LMD‑GHOST 포크 선택</strong>, <strong>Casper FFG 최종성</strong>, <strong>검증자 보상·벌칙 체계</strong> 를 결합해 에너지 효율과 보안을 동시에 달성하려는 설계임
운영자는 시간 동기화와 피어 품질, 키 관리, 클라이언트 다양성, 보상·출금 파이프라인을 지속적으로 점검해야 함
짧은 reorg는 네트워크 현실에서 발생할 수 있으나 적절한 인프라와 파라미터 튜닝, 최신 클라이언트 운용으로 빈도와 영향을 최소화할 수 있음</p><hr><h3 id=참고자료>참고자료<a hidden class=anchor aria-hidden=true href=#참고자료>#</a></h3><ul><li>이더리움 PoS 개요
<a href=https://ethereum.org/en/developers/docs/consensus-mechanisms/pos>https://ethereum.org/en/developers/docs/consensus-mechanisms/pos</a></li><li>합의 사양과 가스퍼 개요
<a href=https://github.com/ethereum/consensus-specs>https://github.com/ethereum/consensus-specs</a></li><li>EIP‑4895 출금과 Capella 업그레이드 참고
<a href=https://eips.ethereum.org/EIPS/eip-4895>https://eips.ethereum.org/EIPS/eip-4895</a></li><li>합의 계층 클라이언트와 실행 계층 클라이언트 목록
<a href=https://ethereum.org/en/developers/docs/nodes-and-clients>https://ethereum.org/en/developers/docs/nodes-and-clients</a></li><li>MEV‑Boost 운영 가이드 참고
<a href=https://www.flashbots.net>https://www.flashbots.net</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://handsupmin.github.io/tags/ethereum/>Ethereum</a></li><li><a href=https://handsupmin.github.io/tags/pos/>PoS</a></li><li><a href=https://handsupmin.github.io/tags/beacon-chain/>Beacon-Chain</a></li><li><a href=https://handsupmin.github.io/tags/staking/>Staking</a></li><li><a href=https://handsupmin.github.io/tags/slot/>Slot</a></li><li><a href=https://handsupmin.github.io/tags/epoch/>Epoch</a></li><li><a href=https://handsupmin.github.io/tags/validator/>Validator</a></li></ul><nav class=paginav><a class=prev href=https://handsupmin.github.io/posts/merkle-tree-blockchain-role-274b74/><span class=title>« Prev</span><br><span>머클트리(Merkle Tree)란? 머클트리의 개념과 블록체인에서의 역할</span>
</a><a class=next href=https://handsupmin.github.io/posts/nft-23q12akw/><span class=title>Next »</span><br><span>NFT 핵심 용어 정리</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 이더리움 PoS(Proof of Stake) 소개 on x" href="https://x.com/intent/tweet/?text=%ec%9d%b4%eb%8d%94%eb%a6%ac%ec%9b%80%20PoS%28Proof%20of%20Stake%29%20%ec%86%8c%ea%b0%9c&amp;url=https%3a%2f%2fhandsupmin.github.io%2fposts%2fethereum-pos-proof-of-stake-274b74%2f&amp;hashtags=ethereum%2cPoS%2cbeacon-chain%2cstaking%2cslot%2cepoch%2cvalidator"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 이더리움 PoS(Proof of Stake) 소개 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fhandsupmin.github.io%2fposts%2fethereum-pos-proof-of-stake-274b74%2f&amp;title=%ec%9d%b4%eb%8d%94%eb%a6%ac%ec%9b%80%20PoS%28Proof%20of%20Stake%29%20%ec%86%8c%ea%b0%9c&amp;summary=%ec%9d%b4%eb%8d%94%eb%a6%ac%ec%9b%80%20PoS%28Proof%20of%20Stake%29%20%ec%86%8c%ea%b0%9c&amp;source=https%3a%2f%2fhandsupmin.github.io%2fposts%2fethereum-pos-proof-of-stake-274b74%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 이더리움 PoS(Proof of Stake) 소개 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fhandsupmin.github.io%2fposts%2fethereum-pos-proof-of-stake-274b74%2f&title=%ec%9d%b4%eb%8d%94%eb%a6%ac%ec%9b%80%20PoS%28Proof%20of%20Stake%29%20%ec%86%8c%ea%b0%9c"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 이더리움 PoS(Proof of Stake) 소개 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fhandsupmin.github.io%2fposts%2fethereum-pos-proof-of-stake-274b74%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 이더리움 PoS(Proof of Stake) 소개 on whatsapp" href="https://api.whatsapp.com/send?text=%ec%9d%b4%eb%8d%94%eb%a6%ac%ec%9b%80%20PoS%28Proof%20of%20Stake%29%20%ec%86%8c%ea%b0%9c%20-%20https%3a%2f%2fhandsupmin.github.io%2fposts%2fethereum-pos-proof-of-stake-274b74%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 이더리움 PoS(Proof of Stake) 소개 on telegram" href="https://telegram.me/share/url?text=%ec%9d%b4%eb%8d%94%eb%a6%ac%ec%9b%80%20PoS%28Proof%20of%20Stake%29%20%ec%86%8c%ea%b0%9c&amp;url=https%3a%2f%2fhandsupmin.github.io%2fposts%2fethereum-pos-proof-of-stake-274b74%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 이더리움 PoS(Proof of Stake) 소개 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%ec%9d%b4%eb%8d%94%eb%a6%ac%ec%9b%80%20PoS%28Proof%20of%20Stake%29%20%ec%86%8c%ea%b0%9c&u=https%3a%2f%2fhandsupmin.github.io%2fposts%2fethereum-pos-proof-of-stake-274b74%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://handsupmin.github.io/>HandsLog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>