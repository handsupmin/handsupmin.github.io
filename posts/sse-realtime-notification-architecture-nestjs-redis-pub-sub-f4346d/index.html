<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub | HandsLog</title>
<meta name=keywords content="sse,server-sent-events,redis,pub-sub,nestjs,kubernetes,real-time,backend-architecture"><meta name=description content="SSE 기반 실시간 알림 설계서 NestJS + Redis Pub/Sub
목적

QR 이벤트 보상 알림과 채팅 등 다양한 도메인의 서버→클라이언트 실시간 전달을 표준 HTTP 기반인 SSE로 단일 파이프라인에서 처리함
Kubernetes 다중 인스턴스 환경에서도 단순하고 견고하게 동작하도록 Redis Pub/Sub를 브로커로 채택함

대상 독자

초보 백엔드 대상 SSE와 Pub/Sub의 개념, 동작 방식, 최소 구현 흐름 정리
시니어 백엔드 대상 채널·이벤트 모델, 커넥션 레지스트리, 운영 지표와 신뢰성 포지션, 트레이드오프 명확화


1) 개념 요약


SSE Server‑Sent Events"><meta name=author content><link rel=canonical href=https://handsupmin.github.io/posts/sse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d/><link crossorigin=anonymous href=/assets/css/stylesheet.08f7d74f0ada0f975d29ae436285b61ed7a719d05f350cb888d00341642995a2.css integrity="sha256-CPfXTwraD5ddKa5DYoW2HtenGdBfNQy4iNADQWQplaI=" rel="preload stylesheet" as=style><link rel=icon href=https://handsupmin.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://handsupmin.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://handsupmin.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://handsupmin.github.io/apple-touch-icon.png><link rel=mask-icon href=https://handsupmin.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://handsupmin.github.io/posts/sse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NKJRT1NC1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6NKJRT1NC1")</script><meta name=google-adsense-account content="ca-pub-6022353980017733"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6022353980017733" crossorigin=anonymous></script><meta property="og:url" content="https://handsupmin.github.io/posts/sse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d/"><meta property="og:site_name" content="HandsLog"><meta property="og:title" content="SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub"><meta property="og:description" content="SSE 기반 실시간 알림 설계서 NestJS + Redis Pub/Sub 목적 QR 이벤트 보상 알림과 채팅 등 다양한 도메인의 서버→클라이언트 실시간 전달을 표준 HTTP 기반인 SSE로 단일 파이프라인에서 처리함 Kubernetes 다중 인스턴스 환경에서도 단순하고 견고하게 동작하도록 Redis Pub/Sub를 브로커로 채택함 대상 독자 초보 백엔드 대상 SSE와 Pub/Sub의 개념, 동작 방식, 최소 구현 흐름 정리 시니어 백엔드 대상 채널·이벤트 모델, 커넥션 레지스트리, 운영 지표와 신뢰성 포지션, 트레이드오프 명확화 1) 개념 요약 SSE Server‑Sent Events"><meta property="og:locale" content="ko-kr"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-25T13:06:24+00:00"><meta property="article:modified_time" content="2025-10-25T13:06:24+00:00"><meta property="article:tag" content="Sse"><meta property="article:tag" content="Server-Sent-Events"><meta property="article:tag" content="Redis"><meta property="article:tag" content="Pub-Sub"><meta property="article:tag" content="Nestjs"><meta property="article:tag" content="Kubernetes"><meta name=twitter:card content="summary"><meta name=twitter:title content="SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub"><meta name=twitter:description content="SSE 기반 실시간 알림 설계서 NestJS + Redis Pub/Sub
목적

QR 이벤트 보상 알림과 채팅 등 다양한 도메인의 서버→클라이언트 실시간 전달을 표준 HTTP 기반인 SSE로 단일 파이프라인에서 처리함
Kubernetes 다중 인스턴스 환경에서도 단순하고 견고하게 동작하도록 Redis Pub/Sub를 브로커로 채택함

대상 독자

초보 백엔드 대상 SSE와 Pub/Sub의 개념, 동작 방식, 최소 구현 흐름 정리
시니어 백엔드 대상 채널·이벤트 모델, 커넥션 레지스트리, 운영 지표와 신뢰성 포지션, 트레이드오프 명확화


1) 개념 요약


SSE Server‑Sent Events"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://handsupmin.github.io/posts/"},{"@type":"ListItem","position":2,"name":"SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub","item":"https://handsupmin.github.io/posts/sse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub","name":"SSE 기반 실시간 알림 아키텍처 설계 NestJS \u002b Redis Pub\/Sub","description":"SSE 기반 실시간 알림 설계서 NestJS + Redis Pub/Sub 목적 QR 이벤트 보상 알림과 채팅 등 다양한 도메인의 서버→클라이언트 실시간 전달을 표준 HTTP 기반인 SSE로 단일 파이프라인에서 처리함 Kubernetes 다중 인스턴스 환경에서도 단순하고 견고하게 동작하도록 Redis Pub/Sub를 브로커로 채택함 대상 독자 초보 백엔드 대상 SSE와 Pub/Sub의 개념, 동작 방식, 최소 구현 흐름 정리 시니어 백엔드 대상 채널·이벤트 모델, 커넥션 레지스트리, 운영 지표와 신뢰성 포지션, 트레이드오프 명확화 1) 개념 요약 SSE Server‑Sent Events\n","keywords":["sse","server-sent-events","redis","pub-sub","nestjs","kubernetes","real-time","backend-architecture"],"articleBody":"SSE 기반 실시간 알림 설계서 NestJS + Redis Pub/Sub 목적 QR 이벤트 보상 알림과 채팅 등 다양한 도메인의 서버→클라이언트 실시간 전달을 표준 HTTP 기반인 SSE로 단일 파이프라인에서 처리함 Kubernetes 다중 인스턴스 환경에서도 단순하고 견고하게 동작하도록 Redis Pub/Sub를 브로커로 채택함 대상 독자 초보 백엔드 대상 SSE와 Pub/Sub의 개념, 동작 방식, 최소 구현 흐름 정리 시니어 백엔드 대상 채널·이벤트 모델, 커넥션 레지스트리, 운영 지표와 신뢰성 포지션, 트레이드오프 명확화 1) 개념 요약 SSE Server‑Sent Events\n표준 HTTP로 끊지 않는 응답 스트림을 열고 서버가 이벤트를 단방향 푸시 브라우저 EventSource가 자동 재접속 제공, 서버가 retry 필드로 간격 제어 가능 양방향이 꼭 필요하지 않은 알림, 피드, 채팅 수신 등 단방향 전달에 적합 Redis Pub/Sub\n발행자가 특정 채널로 메시지를 보내면 해당 채널을 구독한 모든 구독자가 수신 k8s 다중 Pod가 같은 채널을 구독하면 모든 Pod가 메시지를 받고 각 Pod는 자신의 레지스트리에 등록된 연결에만 전달 왜 SSE + Redis 조합인가\n표준 HTTP 기반으로 인프라와 클라이언트 적응 비용이 낮음 Redis로 인스턴스 간 브로드캐스트와 타게팅 라우팅이 단순해짐 2) 요구사항 정리 인증 토큰에서 userId 추출, 연결 키는 userId 기준 채널 단위 구독으로 노이즈 최소화 예시 event-reward, chat k8s 다중 인스턴스 환경에서 정확히 타게팅 로컬 레지스트리 기준 라우팅 단일 엔드포인트 유지, 필요 시 채널 별칭 확장 가능 3) 아키텍처 Client App EventSource로 서버 /bff/v3/event-stream?channel=… 연결 API Server Pods EventStreamController 연결·해제 엔드포인트 제공 EventStreamService 연결 레지스트리, Redis 구독, 라우팅, SSE 전송 담당 Redis 단일 Pub/Sub 채널 sse:broadcast 사용 흐름\n클라이언트가 채널을 지정해 SSE 연결 인증 필수 비즈니스 로직이 Redis sse:broadcast에 target.userId, channel, event, payload를 발행 모든 Pod가 메시지를 수신하고 자신의 레지스트리에 존재하는 해당 userId와 channel 연결에만 SSE 푸시 화면 이탈 시 EventSource.close 호출 또는 서버 DELETE 호출로 정리 4) 데이터 모델 채널 enum CE_EVENT_STREAM_CHANNEL 예시 event-reward, chat 확장 가능 이벤트 enum CE_EVENT_STREAM_EVENT event-reward.granted 보상 지급 완료 chat.message.received 채팅 수신 메시지 페이로드 예시 JSON\n{ \"target\": { \"userId\": 123 }, \"channel\": \"event-reward\", \"event\": \"event-reward.granted\", \"payload\": { \"rewards\": [ { \"title\": \"string\", \"kind\": \"objekt\", \"frontImage\": \"string\", \"backImage\": \"string\" }, { \"title\": \"string\", \"kind\": \"badge\", \"frontImage\": \"string\", \"backImage\": null } ] } } 5) API 설계 인증 Bearer 토큰, 서버에서 auth guard로 userId 추출\n연결 Subscribe\nGET /bff/v3/event-stream?channel=event-reward|chat 응답은 text/event-stream, 최초 이벤트로 { type: ‘connected’, retry: 3000 } 전송 해제 Disconnect\nDELETE /bff/v3/event-stream/channels/:channel { closed: number } 반환 종료된 연결 수 6) 서버 구현 NestJS @Sse 핵심 아이디어 연결마다 Subject 생성 후 Observable로 래핑해 컨트롤러가 반환\n레지스트리 구조 Map","wordCount":"768","inLanguage":"en","datePublished":"2025-10-25T13:06:24.493Z","dateModified":"2025-10-25T13:06:24.493Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://handsupmin.github.io/posts/sse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d/"},"publisher":{"@type":"Organization","name":"HandsLog","logo":{"@type":"ImageObject","url":"https://handsupmin.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://handsupmin.github.io/ accesskey=h title="HandsLog (Alt + H)">HandsLog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://handsupmin.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://handsupmin.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://handsupmin.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://handsupmin.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub</h1><div class=post-meta><span title='2025-10-25 13:06:24.493 +0000 UTC'>October 25, 2025</span></div></header><div class=post-content><h2 id=sse-기반-실시간-알림-설계서-nestjs--redis-pubsub>SSE 기반 실시간 알림 설계서 NestJS + Redis Pub/Sub<a hidden class=anchor aria-hidden=true href=#sse-기반-실시간-알림-설계서-nestjs--redis-pubsub>#</a></h2><h3 id=목적>목적<a hidden class=anchor aria-hidden=true href=#목적>#</a></h3><ul><li>QR 이벤트 보상 알림과 채팅 등 다양한 도메인의 서버→클라이언트 실시간 전달을 표준 HTTP 기반인 SSE로 단일 파이프라인에서 처리함</li><li>Kubernetes 다중 인스턴스 환경에서도 단순하고 견고하게 동작하도록 Redis Pub/Sub를 브로커로 채택함</li></ul><h3 id=대상-독자>대상 독자<a hidden class=anchor aria-hidden=true href=#대상-독자>#</a></h3><ul><li>초보 백엔드 대상 SSE와 Pub/Sub의 개념, 동작 방식, 최소 구현 흐름 정리</li><li>시니어 백엔드 대상 채널·이벤트 모델, 커넥션 레지스트리, 운영 지표와 신뢰성 포지션, 트레이드오프 명확화</li></ul><hr><h2 id=1-개념-요약>1) 개념 요약<a hidden class=anchor aria-hidden=true href=#1-개념-요약>#</a></h2><ul><li><p>SSE Server‑Sent Events</p><ul><li>표준 HTTP로 끊지 않는 응답 스트림을 열고 서버가 이벤트를 단방향 푸시</li><li>브라우저 EventSource가 자동 재접속 제공, 서버가 retry 필드로 간격 제어 가능</li><li>양방향이 꼭 필요하지 않은 알림, 피드, 채팅 수신 등 단방향 전달에 적합</li></ul></li><li><p>Redis Pub/Sub</p><ul><li>발행자가 특정 채널로 메시지를 보내면 해당 채널을 구독한 모든 구독자가 수신</li><li>k8s 다중 Pod가 같은 채널을 구독하면 모든 Pod가 메시지를 받고 각 Pod는 자신의 레지스트리에 등록된 연결에만 전달</li></ul></li><li><p>왜 SSE + Redis 조합인가</p><ul><li>표준 HTTP 기반으로 인프라와 클라이언트 적응 비용이 낮음</li><li>Redis로 인스턴스 간 브로드캐스트와 타게팅 라우팅이 단순해짐</li></ul></li></ul><hr><h2 id=2-요구사항-정리>2) 요구사항 정리<a hidden class=anchor aria-hidden=true href=#2-요구사항-정리>#</a></h2><ul><li>인증 토큰에서 userId 추출, 연결 키는 userId 기준</li><li>채널 단위 구독으로 노이즈 최소화 예시 event-reward, chat</li><li>k8s 다중 인스턴스 환경에서 정확히 타게팅 로컬 레지스트리 기준 라우팅</li><li>단일 엔드포인트 유지, 필요 시 채널 별칭 확장 가능</li></ul><hr><h2 id=3-아키텍처>3) 아키텍처<a hidden class=anchor aria-hidden=true href=#3-아키텍처>#</a></h2><ul><li>Client App EventSource로 서버 /bff/v3/event-stream?channel=… 연결</li><li>API Server Pods<ul><li>EventStreamController 연결·해제 엔드포인트 제공</li><li>EventStreamService 연결 레지스트리, Redis 구독, 라우팅, SSE 전송 담당</li></ul></li><li>Redis 단일 Pub/Sub 채널 sse:broadcast 사용</li></ul><p>흐름</p><ol><li>클라이언트가 채널을 지정해 SSE 연결 인증 필수</li><li>비즈니스 로직이 Redis sse:broadcast에 target.userId, channel, event, payload를 발행</li><li>모든 Pod가 메시지를 수신하고 자신의 레지스트리에 존재하는 해당 userId와 channel 연결에만 SSE 푸시</li><li>화면 이탈 시 EventSource.close 호출 또는 서버 DELETE 호출로 정리</li></ol><hr><h2 id=4-데이터-모델>4) 데이터 모델<a hidden class=anchor aria-hidden=true href=#4-데이터-모델>#</a></h2><ul><li>채널 enum CE_EVENT_STREAM_CHANNEL 예시 event-reward, chat 확장 가능</li><li>이벤트 enum CE_EVENT_STREAM_EVENT<ul><li>event-reward.granted 보상 지급 완료</li><li>chat.message.received 채팅 수신</li></ul></li></ul><p>메시지 페이로드 예시 JSON</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;target&#34;</span>: { <span style=color:#f92672>&#34;userId&#34;</span>: <span style=color:#ae81ff>123</span> },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;channel&#34;</span>: <span style=color:#e6db74>&#34;event-reward&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;event&#34;</span>: <span style=color:#e6db74>&#34;event-reward.granted&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;payload&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;rewards&#34;</span>: [
</span></span><span style=display:flex><span>      { <span style=color:#f92672>&#34;title&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>, <span style=color:#f92672>&#34;kind&#34;</span>: <span style=color:#e6db74>&#34;objekt&#34;</span>, <span style=color:#f92672>&#34;frontImage&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>, <span style=color:#f92672>&#34;backImage&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span> },
</span></span><span style=display:flex><span>      { <span style=color:#f92672>&#34;title&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>, <span style=color:#f92672>&#34;kind&#34;</span>: <span style=color:#e6db74>&#34;badge&#34;</span>, <span style=color:#f92672>&#34;frontImage&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>, <span style=color:#f92672>&#34;backImage&#34;</span>: <span style=color:#66d9ef>null</span> }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=5-api-설계>5) API 설계<a hidden class=anchor aria-hidden=true href=#5-api-설계>#</a></h2><ul><li><p>인증 Bearer 토큰, 서버에서 auth guard로 userId 추출</p></li><li><p>연결 Subscribe</p><ul><li>GET /bff/v3/event-stream?channel=event-reward|chat</li><li>응답은 text/event-stream, 최초 이벤트로 { type: &lsquo;connected&rsquo;, retry: 3000 } 전송</li></ul></li><li><p>해제 Disconnect</p><ul><li>DELETE /bff/v3/event-stream/channels/:channel</li><li>{ closed: number } 반환 종료된 연결 수</li></ul></li></ul><hr><h2 id=6-서버-구현-nestjs-sse>6) 서버 구현 NestJS @Sse<a hidden class=anchor aria-hidden=true href=#6-서버-구현-nestjs-sse>#</a></h2><p>핵심 아이디어 연결마다 Subject 생성 후 Observable로 래핑해 컨트롤러가 반환</p><ul><li><p>레지스트리 구조 Map&lt;userId, Map&lt;channel, Set&lt;Subject&#187;></p><ul><li>동일 사용자·채널에서 다중 탭과 디바이스 동시 수용 Set</li></ul></li><li><p>컨트롤러</p><ul><li>@Sse(&rsquo;/bff/v3/event-stream&rsquo;) → EventStreamService.connect(userId, channel) 반환</li><li>DELETE &lsquo;/bff/v3/event-stream/channels/:channel&rsquo; → 강제 해제</li></ul></li><li><p>서비스</p><ul><li>onModuleInit 구독 전용 Redis 커넥션으로 subscribe 등록<ul><li>구독 커넥션과 발행 커넥션 분리 필수 구독 모드에서는 publish 또는 일반 명령 사용 불가</li><li>Redis 클라이언트 duplicate 기능 활용 예 sub = redis.duplicate 후 sub.subscribe(&lsquo;sse:broadcast&rsquo;)</li></ul></li><li>connect userId와 channel로 Subject 생성, 레지스트리에 저장, 즉시 { type: &lsquo;connected&rsquo;, retry: 3000 } push, Observable 반환 구독 해제 시 정리</li><li>publish 발행 전용 커넥션으로 PUBLISH 호출</li><li>handleIncoming Redis 메시지 파싱 후 대상 userId와 channel 매칭, 해당 Subject들에 next({ type: event, data }) 전송</li></ul></li></ul><p>메시지 전송 보장에 대한 포지션</p><ul><li>기본 at‑most‑once 제공</li><li>재전송 필요 시 Last-Event-ID와 서버측 버퍼 메모리 또는 Redis Streams 등으로 보강 가능</li></ul><hr><h2 id=7-운영스케일링보안신뢰성>7) 운영·스케일링·보안·신뢰성<a hidden class=anchor aria-hidden=true href=#7-운영스케일링보안신뢰성>#</a></h2><ul><li><p>스케일링 k8s</p><ul><li>모든 Pod가 같은 Pub/Sub 채널 구독</li><li>로컬 레지스트리 기준으로만 전송</li><li>sticky session 불필요</li></ul></li><li><p>재접속</p><ul><li>retry 필드로 재접속 간격 제어 예 3000ms</li><li>인프라 idle 타임아웃이 짧다면 heartbeat 이벤트 도입 검토</li></ul></li><li><p>보안</p><ul><li>인증 강제 userId 추출</li><li>채널 화이트리스트 검증</li><li>연결 수 제한과 레이트리밋 권장</li></ul></li><li><p>관측 지표</p><ul><li>현재 연결 수 전체·채널별</li><li>publish 수와 전달 건수</li><li>에러율과 재접속률</li><li>Redis 재연결 이벤트 모니터링</li></ul></li></ul><hr><h2 id=8-클라이언트-예시>8) 클라이언트 예시<a hidden class=anchor aria-hidden=true href=#8-클라이언트-예시>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>es</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>EventSource</span>(<span style=color:#e6db74>&#39;/bff/v3/event-stream?channel=event-reward&#39;</span>, { <span style=color:#a6e22e>withCredentials</span>: <span style=color:#66d9ef>true</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>es</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;connected&#39;</span>, (<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;connected&#39;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>data</span>))
</span></span><span style=display:flex><span><span style=color:#a6e22e>es</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;event-reward.granted&#39;</span>, (<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;reward&#39;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>data</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 화면 이탈 시
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>es</span>.<span style=color:#a6e22e>close</span>()
</span></span><span style=display:flex><span><span style=color:#75715e>// 또는 서버 해제 API
</span></span></span><span style=display:flex><span><span style=color:#75715e>// await fetch(&#39;/bff/v3/event-stream/channels/event-reward&#39;, { method: &#39;DELETE&#39; })
</span></span></span></code></pre></div><hr><h2 id=9-트러블슈팅>9) 트러블슈팅<a hidden class=anchor aria-hidden=true href=#9-트러블슈팅>#</a></h2><ul><li><p>Connection in subscriber mode, only subscriber commands may be used</p><ul><li>원인 같은 Redis 커넥션을 SUBSCRIBE와 PUBLISH에 모두 사용</li><li>해결 구독 전용과 발행 전용 커넥션 분리 구독 전용은 duplicate로 분리해 사용</li></ul></li><li><p>404 Not Found disconnect 호출 시</p><ul><li>잘못된 앱 인스턴스 또는 포트로 호출, 컨트롤러 미등록·미배포 가능성</li><li>클라이언트 호출 경로, 배포 상태, 재기동 필요 여부 확인</li></ul></li><li><p>이벤트 미수신</p><ul><li>connected 수신 여부 확인</li><li>채널과 userId 매칭 점검</li><li>Redis 메시지 스키마 필드 누락 여부 확인</li></ul></li></ul><hr><h2 id=10-이력서용-요약>10) 이력서용 요약<a hidden class=anchor aria-hidden=true href=#10-이력서용-요약>#</a></h2><ul><li>NestJS @Sse와 Redis Pub/Sub 기반 실시간 알림 파이프라인 설계·구현<ul><li>단일 브로커 Redis sse:broadcast와 로컬 레지스트리 라우팅으로 k8s 멀티 인스턴스 대응</li><li>채널 기반 구독 event-reward, chat과 userId 타게팅으로 노이즈 최소화</li><li>@Sse + Observable MessageEvent 채택, 재접속 간격 retry 제공, 필요 시 heartbeat 옵션</li><li>구독·발행 커넥션 분리로 안정성 확보, 컨트롤러·서비스 모듈 구조</li><li>at‑most‑once 기본, Last‑Event‑ID + 버퍼로 at‑least‑once 확장 가능성 제시</li></ul></li></ul><p>성과·지표 예시</p><ul><li>다중 Pod 환경에서 지연 수 ms~수십 ms, 전송 성공률 99.9%+ 관측</li><li>연결 수, 전달 건수, 에러율 등 운영 지표로 이슈 분석 시간 단축</li></ul><h3 id=참고자료>참고자료<a hidden class=anchor aria-hidden=true href=#참고자료>#</a></h3><ul><li><a href=https://developer.mozilla.org/docs/Web/API/Server-sent_events>https://developer.mozilla.org/docs/Web/API/Server-sent_events</a></li><li><a href=https://html.spec.whatwg.org/multipage/server-sent-events.html>https://html.spec.whatwg.org/multipage/server-sent-events.html</a></li><li><a href=https://redis.io/docs/latest/develop/interact/pubsub/>https://redis.io/docs/latest/develop/interact/pubsub/</a></li><li><a href=https://docs.nestjs.com/techniques/streams>https://docs.nestjs.com/techniques/streams</a></li><li><a href=https://developer.mozilla.org/docs/Web/API/EventSource>https://developer.mozilla.org/docs/Web/API/EventSource</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://handsupmin.github.io/tags/sse/>Sse</a></li><li><a href=https://handsupmin.github.io/tags/server-sent-events/>Server-Sent-Events</a></li><li><a href=https://handsupmin.github.io/tags/redis/>Redis</a></li><li><a href=https://handsupmin.github.io/tags/pub-sub/>Pub-Sub</a></li><li><a href=https://handsupmin.github.io/tags/nestjs/>Nestjs</a></li><li><a href=https://handsupmin.github.io/tags/kubernetes/>Kubernetes</a></li><li><a href=https://handsupmin.github.io/tags/real-time/>Real-Time</a></li><li><a href=https://handsupmin.github.io/tags/backend-architecture/>Backend-Architecture</a></li></ul><nav class=paginav><a class=next href=https://handsupmin.github.io/posts/functional-programming-core-concepts-17a1eb/><span class=title>Next »</span><br><span>함수형 프로그래밍 핵심 개념 요약</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub on x" href="https://x.com/intent/tweet/?text=SSE%20%ea%b8%b0%eb%b0%98%20%ec%8b%a4%ec%8b%9c%ea%b0%84%20%ec%95%8c%eb%a6%bc%20%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98%20%ec%84%a4%ea%b3%84%20NestJS%20%2b%20Redis%20Pub%2fSub&amp;url=https%3a%2f%2fhandsupmin.github.io%2fposts%2fsse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d%2f&amp;hashtags=sse%2cserver-sent-events%2credis%2cpub-sub%2cnestjs%2ckubernetes%2creal-time%2cbackend-architecture"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fhandsupmin.github.io%2fposts%2fsse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d%2f&amp;title=SSE%20%ea%b8%b0%eb%b0%98%20%ec%8b%a4%ec%8b%9c%ea%b0%84%20%ec%95%8c%eb%a6%bc%20%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98%20%ec%84%a4%ea%b3%84%20NestJS%20%2b%20Redis%20Pub%2fSub&amp;summary=SSE%20%ea%b8%b0%eb%b0%98%20%ec%8b%a4%ec%8b%9c%ea%b0%84%20%ec%95%8c%eb%a6%bc%20%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98%20%ec%84%a4%ea%b3%84%20NestJS%20%2b%20Redis%20Pub%2fSub&amp;source=https%3a%2f%2fhandsupmin.github.io%2fposts%2fsse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fhandsupmin.github.io%2fposts%2fsse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d%2f&title=SSE%20%ea%b8%b0%eb%b0%98%20%ec%8b%a4%ec%8b%9c%ea%b0%84%20%ec%95%8c%eb%a6%bc%20%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98%20%ec%84%a4%ea%b3%84%20NestJS%20%2b%20Redis%20Pub%2fSub"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fhandsupmin.github.io%2fposts%2fsse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub on whatsapp" href="https://api.whatsapp.com/send?text=SSE%20%ea%b8%b0%eb%b0%98%20%ec%8b%a4%ec%8b%9c%ea%b0%84%20%ec%95%8c%eb%a6%bc%20%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98%20%ec%84%a4%ea%b3%84%20NestJS%20%2b%20Redis%20Pub%2fSub%20-%20https%3a%2f%2fhandsupmin.github.io%2fposts%2fsse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub on telegram" href="https://telegram.me/share/url?text=SSE%20%ea%b8%b0%eb%b0%98%20%ec%8b%a4%ec%8b%9c%ea%b0%84%20%ec%95%8c%eb%a6%bc%20%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98%20%ec%84%a4%ea%b3%84%20NestJS%20%2b%20Redis%20Pub%2fSub&amp;url=https%3a%2f%2fhandsupmin.github.io%2fposts%2fsse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SSE 기반 실시간 알림 아키텍처 설계 NestJS + Redis Pub/Sub on ycombinator" href="https://news.ycombinator.com/submitlink?t=SSE%20%ea%b8%b0%eb%b0%98%20%ec%8b%a4%ec%8b%9c%ea%b0%84%20%ec%95%8c%eb%a6%bc%20%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98%20%ec%84%a4%ea%b3%84%20NestJS%20%2b%20Redis%20Pub%2fSub&u=https%3a%2f%2fhandsupmin.github.io%2fposts%2fsse-realtime-notification-architecture-nestjs-redis-pub-sub-f4346d%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://handsupmin.github.io/>HandsLog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>